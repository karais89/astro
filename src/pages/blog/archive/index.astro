---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import { getCollection } from 'astro:content';

const base = import.meta.env.BASE_URL || '/';

const posts = (await getCollection('docs', ({ id, data }) => id.startsWith('blog/') && !(data as any)?.draft))
  .filter((p) => (p.data as any)?.date || (p.data as any)?.createdAt);

const years = Array.from(
  new Set(
    posts.map((p) => new Date(((p.data as any)?.date ?? (p.data as any)?.createdAt) as string).getFullYear())
  )
).sort((a, b) => b - a);

const frontmatter = {
  title: '블로그 아카이브',
  description: '연도별로 블로그 글을 모아봅니다',
  editUrl: 'https://github.com/Lonpeach/astro/edit/main/src/pages/blog/archive/index.astro',
};
---
<StarlightPage frontmatter={frontmatter} hasSidebar={false}>
  {years.length === 0 ? (
    <p>아카이브가 비어 있습니다.</p>
  ) : (
    <ul>
      {years.map((year) => (
        <li><a href={`${base}blog/archive/${year}/`}>{year}</a></li>
      ))}
    </ul>
  )}
</StarlightPage>
